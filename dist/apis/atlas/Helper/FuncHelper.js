"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.hasFollowerDataVals = exports.getTargetVersionValues = exports.getTargetFollowerVersionValues = exports.getStaticFieldValues = exports.getStaticFieldNames = exports.getRelatedSkillIds = exports.getOverchargeDataValList = exports.getMutatingFieldValues = exports.getMutatingFieldNames = exports.getMixedDataValList = exports.getLevelDataValList = exports.getFollowerDataValList = exports.getDataValList = exports.funcUpdatesByOvercharge = exports.funcUpdatesByLevel = exports.describeMutators = void 0;
const api_connector_1 = require("@isaaczm/api-connector");
const FuncValueDescriptor_1 = __importDefault(require("../Descriptor/FuncValueDescriptor"));
const hasChangingDataVals = function (vals) {
    if (!vals.length)
        return false;
    let previous = vals[0];
    for (let i = 1; i < vals.length; i++) {
        if (JSON.stringify(previous) !== JSON.stringify(vals[i]))
            return true;
        previous = vals[i];
    }
    return false;
};
const hasUniqueValues = function (values) {
    if (values.length === 0)
        return false;
    return new Set(values.map(value => {
        if (Array.isArray(value))
            return value.join(',');
        return value;
    })).size > 1;
};
function describeMutators(region, func) {
    const dataVals = getDataValList(func), staticVals = getStaticFieldValues(dataVals), mutatingVals = getMutatingFieldValues(dataVals);
    return mutatingVals
        .map(mutatingVal => new FuncValueDescriptor_1.default().export(func, staticVals, mutatingVal));
}
exports.describeMutators = describeMutators;
function funcUpdatesByLevel(func) {
    return hasChangingDataVals(getLevelDataValList(func));
}
exports.funcUpdatesByLevel = funcUpdatesByLevel;
function funcUpdatesByOvercharge(func) {
    return hasChangingDataVals(getOverchargeDataValList(func));
}
exports.funcUpdatesByOvercharge = funcUpdatesByOvercharge;
function getDataValList(func) {
    const isLevel = funcUpdatesByLevel(func), isOvercharge = funcUpdatesByOvercharge(func);
    return isLevel && isOvercharge
        ? getMixedDataValList(func)
        : (isOvercharge ? getOverchargeDataValList(func) : getLevelDataValList(func));
}
exports.getDataValList = getDataValList;
function getFollowerDataValList(func) {
    var _a;
    return (_a = func.followerVals) !== null && _a !== void 0 ? _a : [];
}
exports.getFollowerDataValList = getFollowerDataValList;
function getLevelDataValList(func) {
    var _a;
    return (_a = func.svals) !== null && _a !== void 0 ? _a : [];
}
exports.getLevelDataValList = getLevelDataValList;
function getMixedDataValList(func) {
    const dataVals = [];
    for (let i = 1; i <= 5; i++) {
        let dataVal = getTargetVersionValues(func, i, i);
        if (dataVal !== undefined)
            dataVals.push(dataVal);
    }
    return dataVals;
}
exports.getMixedDataValList = getMixedDataValList;
function getMutatingFieldNames(vals) {
    return Object.values(api_connector_1.DataVal.DataValField).filter(field => {
        const values = vals.map(val => val[field]);
        return hasUniqueValues(values);
    });
}
exports.getMutatingFieldNames = getMutatingFieldNames;
function getMutatingFieldValues(vals) {
    if (!vals.length)
        return [];
    const fields = getMutatingFieldNames(vals), hasDependingVals = vals.filter(val => val.DependFuncVals !== undefined).length > 0, dependingVals = (hasDependingVals
        ? vals.map(val => { var _a; return ((_a = val.DependFuncVals) !== null && _a !== void 0 ? _a : {}); })
        : undefined), dependingMutatingValues = dependingVals ? getMutatingFieldValues(dependingVals) : [], staticValues = getStaticFieldValues(vals);
    return vals.map((val, index) => {
        const mutatingVals = {};
        for (let x in fields) {
            const fieldName = fields[x];
            // @ts-ignore
            mutatingVals[fieldName] = val[fieldName];
        }
        if (staticValues.DependFuncId && dependingMutatingValues[index]) {
            mutatingVals.DependFuncId = staticValues.DependFuncId;
            mutatingVals.DependFuncVals = dependingMutatingValues[index];
        }
        return mutatingVals;
    });
}
exports.getMutatingFieldValues = getMutatingFieldValues;
function getOverchargeDataValList(func) {
    const dataVals = [];
    for (let i = 1; i <= 5; i++) {
        let dataVal = getTargetVersionValues(func, 1, i);
        if (dataVal !== undefined)
            dataVals.push(dataVal);
    }
    return dataVals;
}
exports.getOverchargeDataValList = getOverchargeDataValList;
function getRelatedSkillIds(func) {
    if (func.funcType !== api_connector_1.Func.FuncType.ADD_STATE && func.funcType !== api_connector_1.Func.FuncType.ADD_STATE_SHORT)
        return [];
    const buff = func.buffs[0];
    if (buff.type === api_connector_1.Buff.BuffType.ATTACK_FUNCTION
        || buff.type === api_connector_1.Buff.BuffType.COMMANDATTACK_FUNCTION
        || buff.type === api_connector_1.Buff.BuffType.COMMANDATTACK_BEFORE_FUNCTION
        || buff.type === api_connector_1.Buff.BuffType.COMMANDCODEATTACK_FUNCTION
        || buff.type === api_connector_1.Buff.BuffType.DAMAGE_FUNCTION
        || buff.type === api_connector_1.Buff.BuffType.DEAD_FUNCTION
        || buff.type === api_connector_1.Buff.BuffType.DELAY_FUNCTION
        || buff.type === api_connector_1.Buff.BuffType.GUTS_FUNCTION
        || buff.type === api_connector_1.Buff.BuffType.SELFTURNEND_FUNCTION) {
        const dataVals = getDataValList(func), dataVal = dataVals[0];
        return typeof dataVal.Value === "number" ? [dataVal.Value] : [];
    }
    if (buff.type === api_connector_1.Buff.BuffType.NPATTACK_PREV_BUFF) {
        const dataVals = getDataValList(func), dataVal = dataVals[0];
        return typeof dataVal.SkillID === "number" ? [dataVal.SkillID] : [];
    }
    return [];
}
exports.getRelatedSkillIds = getRelatedSkillIds;
function getStaticFieldNames(vals) {
    return Object.values(api_connector_1.DataVal.DataValField).filter(field => {
        const values = vals.map(val => val[field]);
        return !hasUniqueValues(values);
    });
}
exports.getStaticFieldNames = getStaticFieldNames;
function getStaticFieldValues(vals) {
    if (!vals.length)
        return {};
    const fields = getStaticFieldNames(vals), staticVals = {}, hasDependingVals = vals.filter(val => val.DependFuncVals !== undefined).length > 0, dependingVals = (hasDependingVals
        ? vals.map(val => { var _a; return ((_a = val.DependFuncVals) !== null && _a !== void 0 ? _a : {}); })
        : undefined), dependingStaticValues = dependingVals ? getStaticFieldValues(dependingVals) : undefined;
    for (let x in fields) {
        // @ts-ignore
        staticVals[fields[x]] = vals[0][fields[x]];
    }
    if (hasDependingVals)
        staticVals.DependFuncVals = dependingStaticValues;
    return staticVals;
}
exports.getStaticFieldValues = getStaticFieldValues;
function getTargetFollowerVersionValues(func, level) {
    if (func.followerVals === undefined)
        return undefined;
    return func.followerVals[level - 1];
}
exports.getTargetFollowerVersionValues = getTargetFollowerVersionValues;
function getTargetVersionValues(func, level, overcharge = 1) {
    if (func.svals === undefined)
        return undefined;
    let dataVals;
    if (overcharge === 2 && func.svals2)
        dataVals = func.svals2;
    else if (overcharge === 3 && func.svals3)
        dataVals = func.svals3;
    else if (overcharge === 4 && func.svals4)
        dataVals = func.svals4;
    else if (overcharge === 5 && func.svals5)
        dataVals = func.svals5;
    else
        dataVals = func.svals;
    return dataVals[level - 1];
}
exports.getTargetVersionValues = getTargetVersionValues;
function hasFollowerDataVals(func) {
    return func.followerVals !== undefined;
}
exports.hasFollowerDataVals = hasFollowerDataVals;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRnVuY0hlbHBlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hcGlzL2F0bGFzL0hlbHBlci9GdW5jSGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDBEQUFxRTtBQUNyRSw0RkFBb0U7QUFFcEUsTUFBTSxtQkFBbUIsR0FBRyxVQUFVLElBQXVCO0lBQ3pELElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTTtRQUNaLE9BQU8sS0FBSyxDQUFDO0lBRWpCLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN2QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtRQUNsQyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEtBQUssSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsT0FBTyxJQUFJLENBQUM7UUFFaEIsUUFBUSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUN0QjtJQUVELE9BQU8sS0FBSyxDQUFDO0FBQ2pCLENBQUMsQ0FBQztBQUVGLE1BQU0sZUFBZSxHQUFHLFVBQVUsTUFBeUM7SUFDdkUsSUFBSSxNQUFNLENBQUMsTUFBTSxLQUFLLENBQUM7UUFDbkIsT0FBTyxLQUFLLENBQUM7SUFFakIsT0FBTyxJQUFJLEdBQUcsQ0FDVixNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFO1FBQ2YsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztZQUNwQixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFM0IsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQyxDQUFDLENBQ0wsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO0FBQ2YsQ0FBQyxDQUFDO0FBRUYsU0FB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QUFDLEtBQUssS0FBSyxTQUFTO1FBQ3hCLE9BQU8sU0FBUyxDQUFDO0lBRXJCLElBQUksUUFBUSxDQUFDO0lBRWIsSUFBSSxVQUFVLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxNQUFNO1FBQy9CLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1NBQ3RCLElBQUksVUFBVSxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUMsTUFBTTtRQUNwQyxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztTQUN0QixJQUFJLFVBQVUsS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLE1BQU07UUFDcEMsUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7U0FDdEIsSUFBSSxVQUFVLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxNQUFNO1FBQ3BDLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDOztRQUV2QixRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztJQUUxQixPQUFPLFFBQVEsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDL0IsQ0FBQztBQWxCRCx3REFrQkM7QUFFRCxTQUFnQixtQkFBbUIsQ0FBQyxJQUFlO0lBQy9DLE9BQU8sSUFBSSxDQUFDLFlBQVksS0FBSyxTQUFTLENBQUM7QUFDM0MsQ0FBQztBQUZELGtEQUVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQnVmZiwgRGF0YVZhbCwgRnVuYywgUmVnaW9uIH0gZnJvbSBcIkBpc2FhY3ptL2FwaS1jb25uZWN0b3JcIjtcbmltcG9ydCBGdW5jVmFsdWVEZXNjcmlwdG9yIGZyb20gXCIuLi9EZXNjcmlwdG9yL0Z1bmNWYWx1ZURlc2NyaXB0b3JcIjtcblxuY29uc3QgaGFzQ2hhbmdpbmdEYXRhVmFscyA9IGZ1bmN0aW9uICh2YWxzOiBEYXRhVmFsLkRhdGFWYWxbXSk6IGJvb2xlYW4ge1xuICAgIGlmICghdmFscy5sZW5ndGgpXG4gICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgIGxldCBwcmV2aW91cyA9IHZhbHNbMF07XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCB2YWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShwcmV2aW91cykgIT09IEpTT04uc3RyaW5naWZ5KHZhbHNbaV0pKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgcHJldmlvdXMgPSB2YWxzW2ldO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbn07XG5cbmNvbnN0IGhhc1VuaXF1ZVZhbHVlcyA9IGZ1bmN0aW9uICh2YWx1ZXM6IChudW1iZXIgfCBudW1iZXJbXSB8IHVuZGVmaW5lZClbXSk6IGJvb2xlYW4ge1xuICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICByZXR1cm4gbmV3IFNldChcbiAgICAgICAgdmFsdWVzLm1hcCh2YWx1ZSA9PiB7XG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlLmpvaW4oJywnKTtcblxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9KVxuICAgICkuc2l6ZSA+IDE7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZGVzY3JpYmVNdXRhdG9ycyhyZWdpb246IFJlZ2lvbiwgZnVuYzogRnVuYy5GdW5jKSB7XG4gICAgY29uc3QgZGF0YVZhbHMgPSBnZXREYXRhVmFsTGlzdChmdW5jKSxcbiAgICAgICAgc3RhdGljVmFscyA9IGdldFN0YXRpY0ZpZWxkVmFsdWVzKGRhdGFWYWxzKSxcbiAgICAgICAgbXV0YXRpbmdWYWxzID0gZ2V0TXV0YXRpbmdGaWVsZFZhbHVlcyhkYXRhVmFscyk7XG5cbiAgICByZXR1cm4gbXV0YXRpbmdWYWxzXG4gICAgICAgIC5tYXAobXV0YXRpbmdWYWwgPT4gbmV3IEZ1bmNWYWx1ZURlc2NyaXB0b3IoKS5leHBvcnQoZnVuYywgc3RhdGljVmFscywgbXV0YXRpbmdWYWwpKTtcbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gZnVuY1VwZGF0ZXNCeUxldmVsKGZ1bmM6IEZ1bmMuRnVuYyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBoYXNDaGFuZ2luZ0RhdGFWYWxzKGdldExldmVsRGF0YVZhbExpc3QoZnVuYykpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZnVuY1VwZGF0ZXNCeU92ZXJjaGFyZ2UoZnVuYzogRnVuYy5GdW5jKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGhhc0NoYW5naW5nRGF0YVZhbHMoZ2V0T3ZlcmNoYXJnZURhdGFWYWxMaXN0KGZ1bmMpKTtcbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGF0YVZhbExpc3QoZnVuYzogRnVuYy5GdW5jKTogRGF0YVZhbC5EYXRhVmFsW10ge1xuICAgIGNvbnN0IGlzTGV2ZWwgPSBmdW5jVXBkYXRlc0J5TGV2ZWwoZnVuYyksXG4gICAgICAgIGlzT3ZlcmNoYXJnZSA9IGZ1bmNVcGRhdGVzQnlPdmVyY2hhcmdlKGZ1bmMpO1xuXG4gICAgcmV0dXJuIGlzTGV2ZWwgJiYgaXNPdmVyY2hhcmdlXG4gICAgICAgID8gZ2V0TWl4ZWREYXRhVmFsTGlzdChmdW5jKVxuICAgICAgICA6IChpc092ZXJjaGFyZ2UgPyBnZXRPdmVyY2hhcmdlRGF0YVZhbExpc3QoZnVuYykgOiBnZXRMZXZlbERhdGFWYWxMaXN0KGZ1bmMpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEZvbGxvd2VyRGF0YVZhbExpc3QoZnVuYzogRnVuYy5GdW5jKTogRGF0YVZhbC5EYXRhVmFsW10ge1xuICAgIHJldHVybiBmdW5jLmZvbGxvd2VyVmFscyA/PyBbXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldExldmVsRGF0YVZhbExpc3QoZnVuYzogRnVuYy5GdW5jKTogRGF0YVZhbC5EYXRhVmFsW10ge1xuICAgIHJldHVybiBmdW5jLnN2YWxzID8/IFtdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TWl4ZWREYXRhVmFsTGlzdChmdW5jOiBGdW5jLkZ1bmMpOiBEYXRhVmFsLkRhdGFWYWxbXSB7XG4gICAgY29uc3QgZGF0YVZhbHMgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IDU7IGkrKykge1xuICAgICAgICBsZXQgZGF0YVZhbCA9IGdldFRhcmdldFZlcnNpb25WYWx1ZXMoZnVuYywgaSwgaSk7XG4gICAgICAgIGlmIChkYXRhVmFsICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICBkYXRhVmFscy5wdXNoKGRhdGFWYWwpO1xuICAgIH1cblxuICAgIHJldHVybiBkYXRhVmFscztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldE11dGF0aW5nRmllbGROYW1lcyh2YWxzOiBEYXRhVmFsLkRhdGFWYWxbXSk6IERhdGFWYWwuRGF0YVZhbEZpZWxkW10ge1xuICAgIHJldHVybiBPYmplY3QudmFsdWVzKERhdGFWYWwuRGF0YVZhbEZpZWxkKS5maWx0ZXIoZmllbGQgPT4ge1xuICAgICAgICBjb25zdCB2YWx1ZXMgPSB2YWxzLm1hcCh2YWwgPT4gdmFsW2ZpZWxkXSk7XG5cbiAgICAgICAgcmV0dXJuIGhhc1VuaXF1ZVZhbHVlcyh2YWx1ZXMpO1xuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TXV0YXRpbmdGaWVsZFZhbHVlcyh2YWxzOiBEYXRhVmFsLkRhdGFWYWxbXSk6IERhdGFWYWwuRGF0YVZhbFtdIHtcbiAgICBpZiAoIXZhbHMubGVuZ3RoKVxuICAgICAgICByZXR1cm4gW107XG5cbiAgICBjb25zdCBmaWVsZHMgPSBnZXRNdXRhdGluZ0ZpZWxkTmFtZXModmFscyksXG4gICAgICAgIGhhc0RlcGVuZGluZ1ZhbHMgPSB2YWxzLmZpbHRlcih2YWwgPT4gdmFsLkRlcGVuZEZ1bmNWYWxzICE9PSB1bmRlZmluZWQpLmxlbmd0aCA+IDAsXG4gICAgICAgIGRlcGVuZGluZ1ZhbHM6IChEYXRhVmFsLkRhdGFWYWxbXSB8IHVuZGVmaW5lZCkgPSAoXG4gICAgICAgICAgICBoYXNEZXBlbmRpbmdWYWxzXG4gICAgICAgICAgICAgICAgPyB2YWxzLm1hcCh2YWwgPT4gKHZhbC5EZXBlbmRGdW5jVmFscyA/PyB7fSkgYXMgRGF0YVZhbC5EYXRhVmFsKVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkXG4gICAgICAgICksXG4gICAgICAgIGRlcGVuZGluZ011dGF0aW5nVmFsdWVzID0gZGVwZW5kaW5nVmFscyA/IGdldE11dGF0aW5nRmllbGRWYWx1ZXMoZGVwZW5kaW5nVmFscykgOiBbXSxcbiAgICAgICAgc3RhdGljVmFsdWVzID0gZ2V0U3RhdGljRmllbGRWYWx1ZXModmFscyk7XG5cbiAgICByZXR1cm4gdmFscy5tYXAoKHZhbCwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgbXV0YXRpbmdWYWxzOiBEYXRhVmFsLkRhdGFWYWwgPSB7fTtcblxuICAgICAgICBmb3IgKGxldCB4IGluIGZpZWxkcykge1xuICAgICAgICAgICAgY29uc3QgZmllbGROYW1lID0gZmllbGRzW3hdO1xuXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBtdXRhdGluZ1ZhbHNbZmllbGROYW1lXSA9IHZhbFtmaWVsZE5hbWVdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN0YXRpY1ZhbHVlcy5EZXBlbmRGdW5jSWQgJiYgZGVwZW5kaW5nTXV0YXRpbmdWYWx1ZXNbaW5kZXhdKSB7XG4gICAgICAgICAgICBtdXRhdGluZ1ZhbHMuRGVwZW5kRnVuY0lkID0gc3RhdGljVmFsdWVzLkRlcGVuZEZ1bmNJZDtcbiAgICAgICAgICAgIG11dGF0aW5nVmFscy5EZXBlbmRGdW5jVmFscyA9IGRlcGVuZGluZ011dGF0aW5nVmFsdWVzW2luZGV4XTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBtdXRhdGluZ1ZhbHM7XG4gICAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRPdmVyY2hhcmdlRGF0YVZhbExpc3QoZnVuYzogRnVuYy5GdW5jKTogRGF0YVZhbC5EYXRhVmFsW10ge1xuICAgIGNvbnN0IGRhdGFWYWxzID0gW107XG5cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSA1OyBpKyspIHtcbiAgICAgICAgbGV0IGRhdGFWYWwgPSBnZXRUYXJnZXRWZXJzaW9uVmFsdWVzKGZ1bmMsIDEsIGkpO1xuICAgICAgICBpZiAoZGF0YVZhbCAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgZGF0YVZhbHMucHVzaChkYXRhVmFsKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZGF0YVZhbHM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRSZWxhdGVkU2tpbGxJZHMoZnVuYzogRnVuYy5GdW5jKTogbnVtYmVyW10ge1xuICAgIGlmIChmdW5jLmZ1bmNUeXBlICE9PSBGdW5jLkZ1bmNUeXBlLkFERF9TVEFURSAmJiBmdW5jLmZ1bmNUeXBlICE9PSBGdW5jLkZ1bmNUeXBlLkFERF9TVEFURV9TSE9SVClcbiAgICAgICAgcmV0dXJuIFtdO1xuXG4gICAgY29uc3QgYnVmZiA9IGZ1bmMuYnVmZnNbMF07XG4gICAgaWYgKFxuICAgICAgICBidWZmLnR5cGUgPT09IEJ1ZmYuQnVmZlR5cGUuQVRUQUNLX0ZVTkNUSU9OXG4gICAgICAgIHx8IGJ1ZmYudHlwZSA9PT0gQnVmZi5CdWZmVHlwZS5DT01NQU5EQVRUQUNLX0ZVTkNUSU9OXG4gICAgICAgIHx8IGJ1ZmYudHlwZSA9PT0gQnVmZi5CdWZmVHlwZS5DT01NQU5EQVRUQUNLX0JFRk9SRV9GVU5DVElPTlxuICAgICAgICB8fCBidWZmLnR5cGUgPT09IEJ1ZmYuQnVmZlR5cGUuQ09NTUFORENPREVBVFRBQ0tfRlVOQ1RJT05cbiAgICAgICAgfHwgYnVmZi50eXBlID09PSBCdWZmLkJ1ZmZUeXBlLkRBTUFHRV9GVU5DVElPTlxuICAgICAgICB8fCBidWZmLnR5cGUgPT09IEJ1ZmYuQnVmZlR5cGUuREVBRF9GVU5DVElPTlxuICAgICAgICB8fCBidWZmLnR5cGUgPT09IEJ1ZmYuQnVmZlR5cGUuREVMQVlfRlVOQ1RJT05cbiAgICAgICAgfHwgYnVmZi50eXBlID09PSBCdWZmLkJ1ZmZUeXBlLkdVVFNfRlVOQ1RJT05cbiAgICAgICAgfHwgYnVmZi50eXBlID09PSBCdWZmLkJ1ZmZUeXBlLlNFTEZUVVJORU5EX0ZVTkNUSU9OXG4gICAgKSB7XG4gICAgICAgIGNvbnN0IGRhdGFWYWxzID0gZ2V0RGF0YVZhbExpc3QoZnVuYyksXG4gICAgICAgICAgICBkYXRhVmFsID0gZGF0YVZhbHNbMF07XG5cbiAgICAgICAgcmV0dXJuIHR5cGVvZiBkYXRhVmFsLlZhbHVlID09PSBcIm51bWJlclwiID8gW2RhdGFWYWwuVmFsdWVdIDogW107XG4gICAgfVxuXG4gICAgaWYgKGJ1ZmYudHlwZSA9PT0gQnVmZi5CdWZmVHlwZS5OUEFUVEFDS19QUkVWX0JVRkYpIHtcbiAgICAgICAgY29uc3QgZGF0YVZhbHMgPSBnZXREYXRhVmFsTGlzdChmdW5jKSxcbiAgICAgICAgICAgIGRhdGFWYWwgPSBkYXRhVmFsc1swXTtcblxuICAgICAgICByZXR1cm4gdHlwZW9mIGRhdGFWYWwuU2tpbGxJRCA9PT0gXCJudW1iZXJcIiA/IFtkYXRhVmFsLlNraWxsSURdIDogW107XG4gICAgfVxuXG4gICAgcmV0dXJuIFtdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3RhdGljRmllbGROYW1lcyh2YWxzOiBEYXRhVmFsLkRhdGFWYWxbXSk6IERhdGFWYWwuRGF0YVZhbEZpZWxkW10ge1xuICAgIHJldHVybiBPYmplY3QudmFsdWVzKERhdGFWYWwuRGF0YVZhbEZpZWxkKS5maWx0ZXIoZmllbGQgPT4ge1xuICAgICAgICBjb25zdCB2YWx1ZXMgPSB2YWxzLm1hcCh2YWwgPT4gdmFsW2ZpZWxkXSk7XG5cbiAgICAgICAgcmV0dXJuICFoYXNVbmlxdWVWYWx1ZXModmFsdWVzKTtcbiAgICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFN0YXRpY0ZpZWxkVmFsdWVzKHZhbHM6IERhdGFWYWwuRGF0YVZhbFtdKTogRGF0YVZhbC5EYXRhVmFsIHtcbiAgICBpZiAoIXZhbHMubGVuZ3RoKVxuICAgICAgICByZXR1cm4ge307XG5cbiAgICBjb25zdCBmaWVsZHMgPSBnZXRTdGF0aWNGaWVsZE5hbWVzKHZhbHMpLFxuICAgICAgICBzdGF0aWNWYWxzOiBEYXRhVmFsLkRhdGFWYWwgPSB7fSxcbiAgICAgICAgaGFzRGVwZW5kaW5nVmFscyA9IHZhbHMuZmlsdGVyKHZhbCA9PiB2YWwuRGVwZW5kRnVuY1ZhbHMgIT09IHVuZGVmaW5lZCkubGVuZ3RoID4gMCxcbiAgICAgICAgZGVwZW5kaW5nVmFsczogKERhdGFWYWwuRGF0YVZhbFtdIHwgdW5kZWZpbmVkKSA9IChcbiAgICAgICAgICAgIGhhc0RlcGVuZGluZ1ZhbHNcbiAgICAgICAgICAgICAgICA/IHZhbHMubWFwKHZhbCA9PiAodmFsLkRlcGVuZEZ1bmNWYWxzID8/IHt9KSBhcyBEYXRhVmFsLkRhdGFWYWwpXG4gICAgICAgICAgICAgICAgOiB1bmRlZmluZWRcbiAgICAgICAgKSxcbiAgICAgICAgZGVwZW5kaW5nU3RhdGljVmFsdWVzID0gZGVwZW5kaW5nVmFscyA/IGdldFN0YXRpY0ZpZWxkVmFsdWVzKGRlcGVuZGluZ1ZhbHMpIDogdW5kZWZpbmVkO1xuXG4gICAgZm9yIChsZXQgeCBpbiBmaWVsZHMpIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBzdGF0aWNWYWxzW2ZpZWxkc1t4XV0gPSB2YWxzWzBdW2ZpZWxkc1t4XV07XG4gICAgfVxuXG4gICAgaWYgKGhhc0RlcGVuZGluZ1ZhbHMpXG4gICAgICAgIHN0YXRpY1ZhbHMuRGVwZW5kRnVuY1ZhbHMgPSBkZXBlbmRpbmdTdGF0aWNWYWx1ZXM7XG5cbiAgICByZXR1cm4gc3RhdGljVmFscztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFRhcmdldEZvbGxvd2VyVmVyc2lvblZhbHVlcyhmdW5jOiBGdW5jLkZ1bmMsIGxldmVsOiBudW1iZXIpOiBEYXRhVmFsLkRhdGFWYWwgfCB1bmRlZmluZWQge1xuICAgIGlmIChmdW5jLmZvbGxvd2VyVmFscyA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuXG4gICAgcmV0dXJuIGZ1bmMuZm9sbG93ZXJWYWxzW2xldmVsIC0gMV07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRUYXJnZXRWZXJzaW9uVmFsdWVzKGZ1bmM6IEZ1bmMuRnVuYywgbGV2ZWw6IG51bWJlciwgb3ZlcmNoYXJnZTogbnVtYmVyID0gMSk6IERhdGFWYWwuRGF0YVZhbCB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKGZ1bmMuc3ZhbHMgPT09IHVuZGVmaW5lZClcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcblxuICAgIGxldCBkYXRhVmFscztcblxuICAgIGlmIChvdmVyY2hhcmdlID09PSAyICYmIGZ1bmMuc3ZhbHMyKVxuICAgICAgICBkYXRhVmFscyA9IGZ1bmMuc3ZhbHMyO1xuICAgIGVsc2UgaWYgKG92ZXJjaGFyZ2UgPT09IDMgJiYgZnVuYy5zdmFsczMpXG4gICAgICAgIGRhdGFWYWxzID0gZnVuYy5zdmFsczM7XG4gICAgZWxzZSBpZiAob3ZlcmNoYXJnZSA9PT0gNCAmJiBmdW5jLnN2YWxzNClcbiAgICAgICAgZGF0YVZhbHMgPSBmdW5jLnN2YWxzNDtcbiAgICBlbHNlIGlmIChvdmVyY2hhcmdlID09PSA1ICYmIGZ1bmMuc3ZhbHM1KVxuICAgICAgICBkYXRhVmFscyA9IGZ1bmMuc3ZhbHM1O1xuICAgIGVsc2VcbiAgICAgICAgZGF0YVZhbHMgPSBmdW5jLnN2YWxzO1xuXG4gICAgcmV0dXJuIGRhdGFWYWxzW2xldmVsIC0gMV07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYXNGb2xsb3dlckRhdGFWYWxzKGZ1bmM6IEZ1bmMuRnVuYyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBmdW5jLmZvbGxvd2VyVmFscyAhPT0gdW5kZWZpbmVkO1xufSJdfQ==